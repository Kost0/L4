package handler

import (
	"bytes"
	"net/http"
	"net/http/httptest"
	"testing"
)

const body = `{"numbers": [64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30, 64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30, 64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30, 64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30, 64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30, 64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30, 64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30, 64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30, 64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30, 64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30,64, 34, 25, 12, 22, 11, 90, 817324, 29374, 237984, 138674, -30]}`

func BenchmarkSort(b *testing.B) {
	bodyBytes := []byte(body)

	bodyReader := bytes.NewReader(bodyBytes)

	req, err := http.NewRequest(http.MethodPost, "http://localhost:8080/sort", bodyReader)
	if err != nil {
		b.Fatalf("Error creating request: %v\n", err)
	}

	b.ResetTimer()

	for i := 0; i < b.N; i++ {
		rr := httptest.NewRecorder()

		SortNums(rr, req)
	}
}
